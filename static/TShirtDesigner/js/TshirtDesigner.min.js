"use strict";function _defineProperty(a,b,c){return b in a?Object.defineProperty(a,b,{value:c,enumerable:!0,configurable:!0,writable:!0}):a[b]=c,a}function Designer(){this.canvas,this.ctx,this.canvasOffset,this.droped=!1,this.font,this.fond,this.dos,this.gauche,this.droite,this.face,this.Y_AXIS=1,this.X_AXIS=2,this.offsetX,this.offsetY,this.startX,this.startY,this.outOfCanvas=!1,this.conserverRatio=!0,this.xText=0,this.yText=0,this.aText=0,this.OSName="Unknown OS",this.ci=0,this.ct=0,this.logo=[],this.text=[],this.buttons=[],this.textareas=[],this.sliders=[],this.inputs=[],this.textarea=function(a){return this.textareas.find(function(b){return b.elt.id==a})},this.button=function(a){return this.buttons.find(function(b){return b.elt.id===a})},this.slider=function(a){return this.sliders.find(function(b){return b.elt.id===a})},this.input=function(a){return this.inputs.find(function(b){return b.elt.id===a})},this.setGradient=function(a,b,c,d,e,f,g){if(noFill(),g==this.Y_AXIS)for(var h=b;h<=b+d;h++){var i=map(h,b,b+d,0,1),j=lerpColor(e,f,i);stroke(j),line(a,h,a+c,h)}else if(g==this.X_AXIS)for(var h=a;h<=a+c;h++){var i=map(h,a,a+c,0,1),j=lerpColor(e,f,i);stroke(j),line(h,b,h,b+d)}},this.modal=function(a){document.getElementById("modalProduit").style.display="none",document.getElementById("modalDesign").style.display="none",document.getElementById("modalTexte").style.display="none",document.getElementById("modalNb").style.display="none",a&&(document.getElementById(a).style.display="block")},this.Position=function(){windowHeight<windowWidth?d.canvas.position(windowWidth/2-this.canvas.width/2-200,document.getElementById("topOfPage").offsetTop+100):d.canvas.position(windowWidth/2-this.canvas.width/2,document.getElementById("topOfPage").offsetTop+100),this.button("buttonProduit").position(this.offsetX-this.button("buttonProduit").width-25,this.offsetY),this.button("buttonDesign").position(this.offsetX-this.button("buttonDesign").width-25,this.offsetY+this.canvas.height/5),this.button("buttonImage").position(this.offsetX-this.button("buttonImage").width-25,this.offsetY+2*this.canvas.height/5),this.button("buttonText").position(this.offsetX-this.button("buttonText").width-25,this.offsetY+3*this.canvas.height/5),this.button("buttonNb").position(this.offsetX-this.button("buttonNb").width-25,this.offsetY+4*this.canvas.height/5),this.button("face").position(this.offsetX+30,this.offsetY+this.canvas.height+20),this.button("dos").position(this.offsetX+30+this.canvas.width/4,this.offsetY+this.canvas.height+20),this.button("droite").position(this.offsetX+30+2*this.canvas.width/4,this.offsetY+this.canvas.height+20),this.button("gauche").position(this.offsetX+30+3*this.canvas.width/4,this.offsetY+this.canvas.height+20);for(var a=document.getElementsByClassName("modal-right"),b=0;b<a.length;b++)a[b].style.position="absolute",a[b].style.top=this.offsetY+"px",a[b].style.left=this.canvas.position().x+this.canvas.width+50+"px",a[b].style.width=2*windowWidth/5+"px",a[b].style.height=this.canvas.height+"px"},this.history={undoList:{face:[],dos:[],gauche:[],droite:[]},index:0,saveState:function(){var a={};Object.assign(a,{ci:d.ci,ct:d.ct}),d.logo.forEach(function(b){var c;Object.assign(a,(c={},_defineProperty(c,"xImage"+b.nb.toString(),b.x),_defineProperty(c,"yImage"+b.nb.toString(),b.y),_defineProperty(c,"widthImage"+b.nb.toString(),b.width),_defineProperty(c,"heightImage"+b.nb.toString(),b.height),c))}),d.text.forEach(function(b){var c;Object.assign(a,(c={},_defineProperty(c,"xText"+b.nb.toString(),b.x),_defineProperty(c,"yText"+b.nb.toString(),b.y),_defineProperty(c,"widthText"+b.nb.toString(),b.width),_defineProperty(c,"heightText"+b.nb.toString(),b.height),c))}),this.index++,d.fond==d.face?this.undoList.face.push(a):d.fond==d.dos?this.undoList.dos.push(a):d.fond==d.droite?this.undoList.droite.push(a):d.fond==d.gauche&&this.undoList.gauche.push(a)},store:function(a,b){b.x=parseFloat(a[this.index]["xImage"+b.nb.toString()]),b.y=parseFloat(a[this.index]["yImage"+b.nb.toString()]),b.width=parseFloat(a[this.index]["widthImage"+b.nb.toString()]),b.height=parseFloat(a[this.index]["heightImage"+b.nb.toString()]),b.right=b.x+b.width,b.bottom=b.y+b.height},update:function(){d.logo.forEach(function(a){isNaN(a.x)&&isNaN(a.y)&&isNaN(a.width)&&isNaN(a.height)&&(d.ci=d.logo.indexOf(a)-1,d.logo.splice(d.logo.indexOf(a),1)),d.fond==d.face?this.store(this.undoList.face,a):d.fond==d.dos?this.store(this.undoList.dos,a):d.fond==d.droite?this.store(this.undoList.droite,a):d.fond==d.gauche&&this.store(this.undoList.gauche,a)},this),d.text.forEach(function(a){isNaN(a.x)&&isNaN(a.y)&&isNaN(a.width)&&isNaN(a.height)&&(d.ct=d.logo.indexOf(a)-1,d.text.splice(d.text.indexOf(a),1)),d.fond==d.face?this.store(this.undoList.face,a):d.fond==d.dos?this.store(this.undoList.dos,a):d.fond==d.droite?this.store(this.undoList.droite,a):d.fond==d.gauche&&this.store(this.undoList.gauche,a)},this),d.ci=this.undoList.face[this.index].ci,d.ct=this.undoList.face[this.index].ct,d.slider("xImage").value(d.logo[d.ci].x),d.slider("yImage").value(d.logo[d.ci].y),d.slider("largeurImage").value(d.logo[d.ci].width),d.slider("hauteurImage").value(d.logo[d.ci].height),d.input("xImageSetting").value(d.logo[d.ci].x),d.input("yImageSetting").value(d.logo[d.ci].x),d.input("largeurImageSetting").value(d.logo[d.ci].width),d.input("hauteurImageSetting").value(d.logo[d.ci].height),d.slider("xTexte").value(d.text[d.ct].x),d.slider("yTexte").value(d.text[d.ct].y),d.slider("largeurTexte").value(d.text[d.ct].width),d.slider("hauteurTexte").value(d.text[d.ct].height),d.input("xTexteSetting").value(d.text[d.ct].x),d.input("yTexteSetting").value(d.text[d.ct].x),d.input("largeurTexteSetting").value(d.text[d.ct].width),d.input("hauteurTexteSetting").value(d.text[d.ct].height)},undo:function(){this.index>2?(this.index--,this.update()):(d.logo[d.ci].image.src="",this.index=0)}}}function Logo(a,b){this.image=new Image,a&&(this.image.src=a.src),this.x=50,this.y=50,this.ratio=.5*b.canvas.width/this.image.width,this.width=this.image.width*this.ratio,this.height=this.image.height*this.ratio,this.right=this.image.x+this.image.width,this.bottom=this.image.y+this.image.height,this.nb=b.logo.length,this.draggingImage=!1,this.draggingResizer,this.resizerRadius=8,this.xRot=0,this.yRot=0,this.aRot=0,this.rr=this.resizerRadius*this.resizerRadius,this.hitImage=function(a,c){var d=a>this.x&&a<this.x+this.width&&c>this.y&&c<this.y+this.height;return d&&(b.ci=this.nb),d},this.anchorHitTestImage=function(a,b){var c=a-this.x,d=b-this.y;return c*c+d*d<=this.rr?0:(c=a-this.right,d=b-this.y,c*c+d*d<=this.rr?1:(c=a-this.right,d=b-this.bottom,c*c+d*d<=this.rr?2:(c=a-this.x,d=b-this.bottom,c*c+d*d<=this.rr?3:-1)))},this.drawDragAnchor=function(a,c){fill(0),b.ctx.beginPath(),b.ctx.arc(a,c,this.resizerRadius,0,2*Math.PI,!1),b.ctx.closePath(),b.ctx.fill()},this.drawDragging=function(a,c,d,e){b.ctx.beginPath(),b.ctx.moveTo(a,c),b.ctx.lineTo(d,c),b.ctx.lineTo(d,e),b.ctx.lineTo(a,e),b.ctx.closePath(),b.ctx.strokeStyle="#0",b.ctx.stroke(),this.drawDragAnchor(a,c),this.drawDragAnchor(d,c),this.drawDragAnchor(d,e),this.drawDragAnchor(a,e)},this.dragg=function(a){if(this.draggingResizer>-1){if(b.conserverRatio){switch(this.draggingResizer){case 0:this.x=mouseX,this.y=mouseY,this.ratio=(this.right-mouseX)/this.width,this.width=this.right-mouseX;break;case 1:this.y=mouseY,this.ratio=(mouseX-this.x)/this.width,this.width=mouseX-this.x;break;case 2:this.ratio=(mouseX-this.x)/this.width,this.width=mouseX-this.x;break;case 3:this.x=mouseX,this.ratio=(this.right-mouseX)/this.width,this.width=this.right-mouseX}this.height*=this.ratio}else switch(this.draggingResizer){case 0:this.x=mouseX,this.y=mouseY,this.width=this.right-mouseX,this.height=this.bottom-mouseY;break;case 1:this.y=mouseY,this.width=mouseX-this.x,this.height=this.bottom-mouseY;break;case 2:this.width=mouseX-this.x,this.height=mouseY-this.y;break;case 3:this.x=mouseX,this.width=this.right-mouseX,this.height=mouseY-this.y}this.width<25&&(this.width=25),this.height<25&&(this.height=25),this.right=this.x+this.width,this.bottom=this.y+this.height,frameCount%25==1&&b.history.saveState()}else if(this.draggingImage){var c=mouseX-b.startX,d=mouseY-b.startY;this.x+=c,this.y+=d,this.right+=c,this.bottom+=d,b.startX=mouseX,b.startY=mouseY,frameCount%25==1&&b.history.saveState()}}}function Text(a){this.x=150,this.y=150,this.fontSize=32,this.width=100,this.height=15,this.right=this.x+this.width,this.bottom=this.y+this.height,this.textColor=[0,0,0],this.draggingText=!1,this.draggingResizerText,this.resizerRadius=8,this.rr=this.resizerRadius*this.resizerRadius,this.nb=a.text.length,this.content="",this.xRot=0,this.yRot=0,this.aRot=0,this.hitText=function(b,c){var d=b>this.x&&b<this.x+this.width&&c>this.y&&c<this.y+this.height;return d&&(a.ct=this.nb),d},this.anchorHitTestText=function(a,b){var c=a-this.x,d=b-this.y;return c*c+d*d<=this.rr?0:(c=a-this.right,d=b-this.y,c*c+d*d<=this.rr?1:(c=a-this.right,d=b-this.bottom,c*c+d*d<=this.rr?2:(c=a-this.x,d=b-this.bottom,c*c+d*d<=this.rr?3:-1)))},this.drawDragAnchor=function(b,c){fill(0),a.ctx.beginPath(),a.ctx.arc(b,c,this.resizerRadius,0,2*Math.PI,!1),a.ctx.closePath(),a.ctx.fill()},this.drawDragging=function(b,c,d,e){a.ctx.beginPath(),a.ctx.moveTo(b,c),a.ctx.lineTo(d,c),a.ctx.lineTo(d,e),a.ctx.lineTo(b,e),a.ctx.closePath(),a.ctx.strokeStyle="#0",a.ctx.stroke(),this.drawDragAnchor(b,c),this.drawDragAnchor(d,c),this.drawDragAnchor(d,e),this.drawDragAnchor(b,e)},this.dragg=function(b){if(this.draggingResizerText>-1){var c=0;switch(this.draggingResizerText){case 0:this.x=mouseX,this.y=mouseY,c=(this.bottom-mouseY)/this.height,this.height=this.bottom-mouseY;break;case 1:this.y=mouseY,c=(this.bottom-mouseY)/this.height,this.height=this.bottom-mouseY;break;case 2:c=(mouseY-this.y)/this.height,this.height=mouseY-this.y;break;case 3:this.x=mouseX,c=(mouseY-this.y)/this.height,this.height=mouseY-this.y}this.width*=c,this.right=this.x+this.width,this.bottom=this.y+this.height,frameCount%25==1&&a.history.saveState()}else if(this.draggingText){var d=mouseX-a.startX,e=mouseY-a.startY;this.x+=d,this.y+=e,this.right+=d,this.bottom+=e,a.startX=mouseX,a.startY=mouseY,frameCount%25==1&&a.history.saveState()}}}function colorPicker_OnClick(a){var b=document.createElement("div");b.style.color=a,document.body.appendChild(b);var c=window.getComputedStyle(b).color.split(", ");d.text[d.ct].textColor[0]=Number(c[0].slice(4)),d.text[d.ct].textColor[1]=Number(c[1]),d.text[d.ct].textColor[2]=Number(c[2].slice(0,c[2].length-1))}function changeProdcut(a){var b="/media/achetez/produit/";d.face=loadImage(b+a+"-face.png"),d.dos=loadImage(b+a+"-dos.png"),d.droite=loadImage(b+a+"-droite.png"),d.gauche=loadImage(b+a+"-gauche.png"),d.button("face").style("background-image","url('"+b+a+"-face.png')"),d.button("dos").style("background-image","url('"+b+a+"-dos.png')"),d.button("droite").style("background-image","url('"+b+a+"-droite.png')"),d.button("gauche").style("background-image","url('"+b+a+"-gauche.png')"),d.fond=d.face}function onFileSelected(a){var b=new Image;b.src=a.target.result,console.log(a.target),console.log(a.target.files),console.log(a.target.result),gotfile(b)}function gotfile(a){console.log("droped"),d.droped=!0,0==d.ci&&""==d.logo[d.ci].image.src?(d.logo.pop(),d.logo[0]=new Logo(a,d)):(d.logo.push(new Logo(a,d)),d.ci++),d.history.saveState(),d.slider("largeurImage").value(d.logo[d.ci].width),d.slider("hauteurImage").value(d.logo[d.ci].height),d.input("largeurImageSetting").value(d.logo[d.ci].width),d.input("hauteurImageSetting").value(d.logo[d.ci].height)}function setup(){d=new Designer;var a="/media/achetez/produit/";d.font=loadFont("/static/font/Caviar-Dreams/web_fonts/caviardreams_regular_macroman/CaviarDreams-webfont.ttf"),d.face=loadImage(a+document.getElementById("fond_id").innerHTML+"-face.png"),d.dos=loadImage(a+document.getElementById("fond_id").innerHTML+"-dos.png"),d.droite=loadImage(a+document.getElementById("fond_id").innerHTML+"-droite.png"),d.gauche=loadImage(a+document.getElementById("fond_id").innerHTML+"-gauche.png"),d.fond=d.face,document.getElementById("conteneur").style.height=windowHeight+300+"px",-1!=navigator.appVersion.indexOf("Win")&&(d.OSName="Windows"),-1!=navigator.appVersion.indexOf("Mac")&&(d.OSName="MacOS"),-1!=navigator.appVersion.indexOf("X11")&&(d.OSName="UNIX"),-1!=navigator.appVersion.indexOf("Linux")&&(d.OSName="Linux"),d.canvas=createCanvas(4*windowHeight/5,4*windowHeight/5);d.canvas.size().width,d.canvas.size().height;d.ctx=d.canvas.elt.getContext("2d"),d.canvasOffset=d.canvas.position(),d.offsetX=d.canvasOffset.x,d.offsetY=d.canvasOffset.y,d.logo.push(new Logo("",d)),d.logo[0].ratio=1,d.logo[0].x=width/2,d.logo[0].y=height/2,d.logo[0].width=25,d.logo[0].height=25,d.logo[0].right=d.logo[0].x+d.logo[0].width,d.logo[0].bottom=d.logo[0].y+d.logo[0].height,d.text.push(new Text(d)),d.textareas.push(new p5.Element(document.getElementById("first"))),d.buttons.push(new p5.Element(document.getElementById("buttonNb"))),d.buttons.push(new p5.Element(document.getElementById("buttonProduit"))),d.buttons.push(new p5.Element(document.getElementById("buttonDesign"))),d.buttons.push(new p5.Element(document.getElementById("buttonImage"))),d.buttons.push(new p5.Element(document.getElementById("buttonText"))),d.buttons.push(new p5.Element(document.getElementById("face"))),d.buttons.push(new p5.Element(document.getElementById("dos"))),d.buttons.push(new p5.Element(document.getElementById("droite"))),d.buttons.push(new p5.Element(document.getElementById("gauche"))),d.buttons.push(new p5.Element(document.getElementById("choixDesign"))),d.buttons.push(new p5.Element(document.getElementById("choixParametreDesign"))),d.buttons.push(new p5.Element(document.getElementById("choixCouleurDesign"))),d.buttons.push(new p5.Element(document.getElementById("choixTexte"))),d.buttons.push(new p5.Element(document.getElementById("choixParametreTexte"))),d.buttons.push(new p5.Element(document.getElementById("choixCouleurTexte"))),d.buttons.push(new p5.Element(document.getElementById("ajoutText"))),d.sliders.push(new p5.Element(document.getElementById("tailleTexte"))),d.sliders.push(new p5.Element(document.getElementById("orientationTexte"))),d.sliders.push(new p5.Element(document.getElementById("xTexte"))),d.sliders.push(new p5.Element(document.getElementById("yTexte"))),d.sliders.push(new p5.Element(document.getElementById("tailleImage"))),d.sliders.push(new p5.Element(document.getElementById("orientationImage"))),d.sliders.push(new p5.Element(document.getElementById("xImage"))),d.sliders.push(new p5.Element(document.getElementById("yImage"))),d.sliders.push(new p5.Element(document.getElementById("largeurImage"))),d.sliders.push(new p5.Element(document.getElementById("hauteurImage"))),d.sliders.push(new p5.Element(document.getElementById("largeurTexte"))),d.sliders.push(new p5.Element(document.getElementById("hauteurTexte"))),d.inputs.push(new p5.Element(document.getElementById("xImageSetting"))),d.inputs.push(new p5.Element(document.getElementById("yImageSetting"))),d.inputs.push(new p5.Element(document.getElementById("largeurImageSetting"))),d.inputs.push(new p5.Element(document.getElementById("hauteurImageSetting"))),d.inputs.push(new p5.Element(document.getElementById("xTexteSetting"))),d.inputs.push(new p5.Element(document.getElementById("yTexteSetting"))),d.inputs.push(new p5.Element(document.getElementById("largeurTexteSetting"))),d.inputs.push(new p5.Element(document.getElementById("hauteurTexteSetting"))),d.inputs.push(new p5.Element(document.getElementById("ratio"))),d.inputs.push(new p5.Element(document.getElementById("quadrillage"))),d.inputs.push(new p5.Element(document.getElementById("quadrillageTexte"))),d.textarea("first").size(300,35).value("Ajoutez du texte sur votre CUSTOM !"),d.Position(),d.canvas.drop(gotfile),d.canvas.mousePressed(function(a){d.startX=mouseX,d.startY=mouseY,d.logo.forEach(function(a){a.draggingResizer=a.anchorHitTestImage(d.startX,d.startY),a.draggingImage=a.draggingResizer<0&&a.hitImage(d.startX,d.startY)}),d.text.forEach(function(a){a.draggingResizerText=a.anchorHitTestText(d.startX,d.startY),a.draggingText=a.draggingResizerText<0&&d.text[d.ct].hitText(d.startX,d.startY)})}),d.canvas.mouseMoved(function(a){d.outOfCanvas=!1,d.logo[d.ci].dragg(a),d.text[d.ct].dragg(a),d.slider("xImage").value(d.logo[d.ci].x),d.slider("yImage").value(d.logo[d.ci].y),d.slider("largeurImage").value(d.logo[d.ci].width),d.slider("hauteurImage").value(d.logo[d.ci].height),d.slider("xTexte").value(d.text[d.ct].x),d.slider("yTexte").value(d.text[d.ct].y),d.slider("largeurTexte").value(d.text[d.ct].width),d.slider("hauteurTexte").value(d.text[d.ct].height)}),d.canvas.elt.addEventListener("mouseup",function(a){d.logo[d.ci].draggingResizer=-1,d.logo[d.ci].draggingImage=!1,d.text[d.ct].draggingResizerText=-1,d.text[d.ct].draggingText=!1}),d.canvas.mouseOut(function(a){d.logo[d.ci].draggingResizer=-1,d.logo[d.ci].draggingImage=!1,d.text[d.ct].draggingResizerText=-1,d.text[d.ct].draggingText=!1,d.outOfCanvas=!0,d.history.saveState()}),d.button("ajoutText").mousePressed(function(){"Ajoutez du texte sur votre CUSTOM !"==d.textarea("first").value()?(d.textarea("first").value(""),d.textarea("first").elt.focus()):(d.textareas.push(createElement("textarea").id("textarea"+d.ct)),d.textarea("first").parent().appendChild(d.textarea("textarea"+d.ct).elt)),d.ct<9?d.ct++:d.ct=9,d.text.push(new Text(d))}),d.button("face").mousePressed(function(){d.fond=d.face}),d.button("dos").mousePressed(function(){d.fond=d.dos}),d.button("droite").mousePressed(function(){d.fond=d.droite}),d.button("gauche").mousePressed(function(){d.fond=d.gauche}),d.button("buttonDesign").mousePressed(function(){d.modal("modalDesign")}),d.button("buttonText").mousePressed(function(){d.modal("modalTexte")}),d.button("buttonProduit").mousePressed(function(){d.modal("modalProduit")}),d.button("buttonNb").mousePressed(function(){d.modal("modalNb")}),d.button("choixDesign").mousePressed(function(){document.getElementById("choisiDesign").style.display="block",document.getElementById("choisiParametreDesign").style.display="none",document.getElementById("choisiCouleurDesign").style.display="none"}),d.button("choixParametreDesign").mousePressed(function(){document.getElementById("choisiDesign").style.display="none",document.getElementById("choisiParametreDesign").style.display="block",document.getElementById("choisiCouleurDesign").style.display="none"}),d.button("choixCouleurDesign").mousePressed(function(){document.getElementById("choisiDesign").style.display="none",document.getElementById("choisiParametreDesign").style.display="none",document.getElementById("choisiCouleurDesign").style.display="block"}),d.button("choixTexte").mousePressed(function(){document.getElementById("choisiTexte").style.display="block",document.getElementById("choisiParametreTexte").style.display="none",document.getElementById("choisiCouleurTexte").style.display="none"}),d.button("choixParametreTexte").mousePressed(function(){document.getElementById("choisiTexte").style.display="none",document.getElementById("choisiParametreTexte").style.display="block",document.getElementById("choisiCouleurTexte").style.display="none"}),d.button("choixCouleurTexte").mousePressed(function(){document.getElementById("choisiTexte").style.display="none",document.getElementById("choisiParametreTexte").style.display="none",document.getElementById("choisiCouleurTexte").style.display="block"});for(var b=document.getElementsByClassName("close"),c=0;c<b.length;c++)b[c].onclick=function(){d.modal()};d.slider("xImage").elt.onchange=function(){d.history.saveState()},d.slider("yImage").elt.onchange=function(){d.history.saveState()},d.slider("largeurImage").elt.onchange=function(){d.history.saveState()},d.slider("hauteurImage").elt.onchange=function(){d.history.saveState()},d.slider("xTexte").elt.onchange=function(){d.history.saveState()},d.slider("yTexte").elt.onchange=function(){d.history.saveState()},d.slider("largeurTexte").elt.onchange=function(){d.history.saveState()},d.slider("hauteurTexte").elt.onchange=function(){d.history.saveState()},d.input("xImageSetting").elt.onchange=function(){d.slider("xImage").value(this.value),d.logo[d.ci].x=this.value,d.history.saveState()},d.input("yImageSetting").elt.onchange=function(){d.slider("yImage").value(this.value),d.logo[d.ci].y=this.value,d.history.saveState()},d.input("largeurImageSetting").elt.onchange=function(){d.slider("largeurImage").value(this.value),d.logo[d.ci].width=this.value,d.logo[d.ci].right=d.logo[d.ci].x+d.logo[d.ci].width,d.history.saveState()},d.input("hauteurImageSetting").elt.onchange=function(){d.slider("hauteurImage").value(this.value),d.logo[d.ci].height=this.value,d.logo[d.ci].bottom=d.logo[d.ci].y+d.logo[d.ci].height,d.history.saveState()},d.input("xTexteSetting").elt.onchange=function(){d.slider("xTexte").value(this.value),d.text[d.ct].x=this.value,d.history.saveState()},d.input("yTexteSetting").elt.onchange=function(){d.slider("yTexte").value(this.value),d.text[d.ct].y=this.value,d.history.saveState()},d.input("largeurTexteSetting").elt.onchange=function(){d.slider("largeurTexte").value(this.value),d.text[d.ct].width=this.value,d.text[d.ct].right=d.text[d.ct].x+d.text[d.ct].width,d.history.saveState()},d.input("hauteurTexteSetting").elt.onchange=function(){d.slider("hauteurTexte").value(this.value),d.text[d.ct].height=this.value,d.text[d.ct].bottom=d.text[d.ct].y+d.text[d.ct].height,d.history.saveState()},d.input("ratio").elt.onchange=function(){d.conserverRatio=this.checked},d.textarea("first").elt.onfocus=function(){"Ajoutez du texte sur votre CUSTOM !"==this.value&&(this.value="")},document.onkeydown=function(a){var b=window.event?event:a;"Windows"!=d.OSName&&"Linux"!=d.OSName&&"UNIX"!=d.OSName||90==b.keyCode&&b.ctrlKey&&d.history.undo(),"MacOS"==d.OSName&&90==b.keyCode&&b.metaKey&&!b.shiftKey&&d.history.undo(),8==b.keyCode&&b.shiftKey&&d.ci>1&&(d.ci--,d.logo.pop())}}function draw(){var a=void 0;d.canvasOffset=d.canvas.position(),d.offsetX=d.canvasOffset.x,d.offsetY=d.canvasOffset.y,d.Position(),background(200),background(d.fond),textFont(d.font),textAlign(CENTER),translate(width/2,height/2),d.droped||"Ajoutez du texte sur votre CUSTOM !"!=d.textarea("first").value()||(textSize(d.text[d.ct].fontSize),text("drop une image !",0,0)),"Ajoutez du texte sur votre CUSTOM !"!=d.textarea("first").value()&&d.text.forEach(function(b){push(),rotate(b.aRot),fill(b.textColor[0],b.textColor[1],b.textColor[2]),textSize(b.fontSize),b.content=d.textareas[b.nb].value(),b.width=Math.max.apply(null,escape(b.content).split("%0A").map(function(a){return textWidth(a)})),b.height=escape(b.content).split("%0A").length*b.fontSize*1.2,b.right=b.x+b.width,b.bottom=b.y+b.height,text(b.content,b.x-width/2,b.y-height/2,b.width,b.height),b.hitText(d.startX,d.startY)&&b.drawDragging(b.x-width/2,b.y-height/2,b.right-width/2,b.bottom-height/2),pop(),push(),textSize(15),b.draggingResizerText>-1?text(Math.floor(b.width)+" x "+Math.floor(b.height),b.x-width/2,b.y-20-height/2):b.hitText(d.startX,d.startY)&&"Ajoutez du texte sur votre CUSTOM !"!=b.content&&text("("+Math.floor(b.x)+" ,"+Math.floor(b.y)+")",b.x-width/2,b.y-20-height/2),pop(),a|=b.x<width/4+15||b.right>3*width/4-15||b.y<height/4||b.bottom>.85*height}),d.droped&&d.logo.forEach(function(b){push(),rotate(b.aRot),d.ctx.drawImage(b.image,0,0,b.image.width,b.image.height,b.x-width/2,b.y-height/2,b.width,b.height),b.hitImage(d.startX,d.startY)&&b.drawDragging(b.x-width/2,b.y-height/2,b.right-width/2,b.bottom-height/2),textSize(15),b.draggingResizer>-1?text(Math.floor(b.width)+" x "+Math.floor(b.height),b.x-width/2,b.y-20-height/2):b.hitImage(d.startX,d.startY)&&""!=b.image.src&&text("("+Math.floor(b.x)+" ,"+Math.floor(b.y)+")",b.x-width/2,b.y-20-height/2),pop(),""!=d.logo[d.ci].src&&(a|=b.x<width/4+15||b.right>3*width/4-15||b.y<height/4||b.bottom>.85*height)}),d.outOfCanvas?(d.logo[d.ci].xRot=cos(.017453292519943*d.slider("orientationImage").value()),d.logo[d.ci].yRot=sin(.017453292519943*d.slider("orientationImage").value()),d.logo[d.ci].aRot=atan2(d.logo[d.ci].yRot,d.logo[d.ci].xRot),d.logo[d.ci].x=d.slider("xImage").value(),d.logo[d.ci].y=d.slider("yImage").value(),d.logo[d.ci].width=d.slider("largeurImage").value(),d.logo[d.ci].height=d.slider("hauteurImage").value(),d.logo[d.ci].right=d.logo[d.ci].x+d.logo[d.ci].width,d.logo[d.ci].bottom=d.logo[d.ci].y+d.logo[d.ci].height,d.text[d.ct].xRot=cos(.017453292519943*d.slider("orientationTexte").value()),d.text[d.ct].yRot=sin(.017453292519943*d.slider("orientationTexte").value()),d.text[d.ct].aRot=atan2(d.text[d.ct].yRot,d.text[d.ct].xRot),d.text[d.ct].x=d.slider("xTexte").value(),d.text[d.ct].y=d.slider("yTexte").value(),d.text[d.ct].width=d.slider("largeurTexte").value(),d.text[d.ct].height=d.slider("hauteurTexte").value(),d.text[d.ct].fontSize=d.slider("tailleTexte").value(),d.text[d.ct].right=d.text[d.ct].x+d.text[d.ct].width,d.text[d.ct].bottom=d.text[d.ct].y+d.text[d.ct].height):d.sliders.forEach(function(a){a.elt.parentElement.nextElementSibling.firstChild.value=a.value()}),keyIsDown(LEFT_ARROW)&&(keyIsDown(ENTER)?(d.aImage<360&&(d.aImage+=.1),d.aImage>=360&&(d.aImage=360)):(d.logo[d.ci].x-=2,d.logo[d.ci].right-=2)),keyIsDown(RIGHT_ARROW)&&(keyIsDown(ENTER)?(d.aImage>0&&(d.aImage-=.1),d.aImage<=0&&(d.aImage=0)):(d.logo[d.ci].x+=2,d.logo[d.ci].right+=2)),keyIsDown(UP_ARROW)&&(keyIsDown(ENTER)||(d.logo[d.ci].y-=2,d.logo[d.ci].bottom-=2)),keyIsDown(DOWN_ARROW)&&(keyIsDown(ENTER)||(d.logo[d.ci].y+=2,d.logo[d.ci].bottom+=2)),a?stroke(255,0,0):stroke(0,0,0),fill(0,0,0,0),rect(-width/4+15,-height/4,width/2-30,height/2+.1*height),(d.input("quadrillage").elt.checked||d.input("quadrillageTexte").elt.checked)&&(push(),stroke(0,0,0),strokeWeight(.15),line(0,-height/2,0,height/2),line(-width/3,-height/2,-width/3,height/2),line(width/3,-height/2,width/3,height/2),line(-width/6,-height/2,-width/6,height/2),line(width/6,-height/2,width/6,height/2),line(-width,height/6,width,height/6),line(-width,height/3,width,height/3),line(-width,-height/3,width,-height/3),line(-width,-height/6,width,-height/6),line(-width,0,width,0),pop())}var d=void 0;